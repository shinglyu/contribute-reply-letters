<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>MozTW Volunteer Form</title>
  </head>
  <body>
    <form id="contact_form">
        <div>
            <label for="name">名字/暱稱:</label>
            <input type="text" id="name" name="name">
        </div>
        <div>
            <label for="mail">E-mail:</label>
            <input type="email" id="email" name="email">
        </div>
        <div>
            
            <input type="checkbox" id="support" value="support">
            <label for="support">幫助使用者</label>
            
            <input type="checkbox" id="qa" value="qa">
            <label for="qa">品質檢測</label>
            
            <input type="checkbox" id="coding" value="coding">
            <label for="coding">寫程式</label>
            
            <input type="checkbox" id="marketing" value="marketing">
            <label for="marketing">協助宣傳</label>
            
            <input type="checkbox" id="localization" value="localization">
            <label for="localization">在地化與翻譯</label>
            
            <input type="checkbox" id="webdev" value="webdev">
            <label for="webdev">網頁開發</label>
            
            <input type="checkbox" id="addons" value="addons">
            <label for="addons">附加元件</label>
            
            <input type="checkbox" id="design" value="design">
            <label for="design">視覺設計</label>
            
            <input type="checkbox" id="documentation" value="documentation">
            <label for="documentation">撰寫文件</label>
            
            <input type="checkbox" id="education" value="education">
            <label for="education">教育</label>
            
            <input type="checkbox" id="suggestions" value="suggestions">
            <label for="suggestions">我有關於 Firefox 的建議</label>
            
            <input type="checkbox" id="issues" value="issues">
            <label for="issues">我遇到了 Firefox 的問題，需要幫助</label>
            
            <input type="checkbox" id="other" value="other">
            <label for="other">其他</label>
            
        </div>
        <button id="submit" type="submit">送出</button>
    </form>
    <script charset="utf-8">
      REQUEST_URL = "<AWS_API_GATEWAY>/ReplyMail";
      document.getElementById("contact_form").onsubmit = function(evt){
        evt.preventDefault();

        var interests = [];
        var inputs = document.getElementsByTagName('input');
        for(var i=0; i<inputs.length; i++) {
          if(inputs[i].type == 'checkbox' && inputs[i].checked == true) {interests.push(inputs[i].value);}
        }

        var data = {
          "name": document.getElementById("name").value,
          "email": document.getElementById("email").value,
          "interests": interests,
        }
        // Debug logging
        console.log(data)

        // The following submission code is inspired by https://github.com/roman01la/JSONFormData

        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function() {
          if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
            // TODO: l10n
            alert("表單已成功送出，感謝您的填寫。")
            return;
          }
          if (xhr.readyState === XMLHttpRequest.DONE && xhr.status !== 200) {
            // TODO: l10n
            alert("糟糕，我們的主機似乎遇到了技術困難，請稍後重新整理再試一次。")
            return;
          }
        }
        xhr.open('POST', REQUEST_URL);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify(data));
        document.getElementById("submit").disabled = true;
      };
    </script>
  </body>
</html>
